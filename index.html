<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link href="fractal_drawing.css" rel="stylesheet">
<title>Fractal Forest ‚Äî Edit Branches ‚Ä¢ Undo/Redo ‚Ä¢ Eraser</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
<header>
    <button id="mobileMenuBtn" class="mobile-only-btn">‚öôÔ∏è Controls</button>
    <strong>Fractal Forest</strong> ‚Äî Tree - Fern modes ‚Ä¢ Click/drag to draw ‚Ä¢ Click branch to edit level <span id="modeBadge" class="modeBadge">Tree</span>
</header>
<main>
  <div class="controls">
    <button id="closeMenuBtn" class="mobile-only-btn">‚úñÔ∏è Close</button>
    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
        <div id="tabButtons" style="flex-grow: 1;">
            <button class="active" data-tab="shapeTab">Shape</button>
            <button data-tab="colorTab">Color</button>
            <button data-tab="presetsTab">Presets</button>
            <button data-tab="historyTab">History</button>
        </div>
        <button id="helpBtn" class="action">?</button>
    </div>
    <div id="helpDisplay" class="small hint" style="display:none; margin-bottom: 8px; padding: 8px; border-radius: 8px; background: #202833;"></div>

    <div id="tabsContainer">
        <div id="shapeTab" class="tab active">
          <div class="btnrow">
            <button id="undoBtn" class="action" title="Ctrl/Cmd+Z">Undo</button>
            <button id="redoBtn" class="action" title="Ctrl/Cmd+Y">Redo</button>
            <button id="clearBtn" class="action">Clear</button>
            <button id="saveBtn" class="action">Save PNG</button>
            <button id="exportSvgBtn" class="action">Export SVG</button>
          </div>
    
          <div id="symmetrySection" style="margin-bottom: 12px; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.05);">
            <label style="display: block; margin-bottom: 6px;">
                <input type="checkbox" id="enableSymmetry" title="Enable symmetrical duplication of all drawn objects."> Enable Symmetry
            </label>
            <div id="symmetryControls" style="display:none;">
                <label class="row" for="symmetryType">Symmetry Type</label>
                <select id="symmetryType">
                    <option value="mirrorH">Mirror Horizontal</option>
                    <option value="mirrorV">Mirror Vertical</option>
                    <option value="mirrorBoth">Mirror Both (4-way)</option>
                    <option value="radial">Radial</option>
                </select>
                <div id="radialCountControls" style="display:none; margin-top: 6px;">
                    <div class="param-row"><label for="radialCount">Radial Count</label><input id="radialCountValue" type="number" min="2" max="12" value="6"></div>
                    <input id="radialCount" type="range" min="2" max="12" value="6" title="Number of radial copies around the center point.">
                </div>
                <button id="setSymmetryCenterBtn" class="action" style="width: 100%; margin-top: 6px; display: none;">Click Canvas to Set Center</button>
                <div id="symmetryCenterDisplay" class="small hint" style="margin-top: 4px; display: none;"></div>
            </div>
          </div>

          <label class="row" for="modeSelect">Mode</label>
          <select id="modeSelect">
            <option value="tree">Tree</option>
            <option value="fern">Fern</option>
            <option value="path">Path</option>
            <option value="mountain">Mountain</option>
            <option value="celestial">Sun/Moon</option>
            <option value="snowflake">Snowflake</option>
            <option value="flower">Flower</option>
            <option value="vine">Vine</option>
            <option value="clouds">Clouds</option>
            <option value="lightning">Lightning</option>
            <option value="grass">Grass</option>
            <option value="sierpinski">Sierpinski Gasket</option>
            <option value="dragon">Dragon Curve</option>
            <option value="texture">Texture Brush</option>
            <option value="eraser">Eraser</option>
          </select>
    
          <div id="treeParams">
            <label style="display:block; margin-top: 10px;">
                <input type="checkbox" id="enableBranchSelection" checked> Enable Branch Selection Mode
            </label>
            <hr style="opacity:.1; margin: 10px 0;">
            <div class="param-row"><label for="levels">Branch levels</label><input id="levelsValue" type="number" min="1" max="10" value="5"></div>
            <input id="levels" type="range" min="1" max="10" value="5" title="The number of recursive branch splits.">
            <div class="param-row"><label for="baseLen">Base length</label><input id="baseLenValue" type="number" min="10" max="220" value="60"></div>
            <input id="baseLen" type="range" min="10" max="220" value="60" title="The length of the first trunk segment in pixels.">
            <div class="param-row"><label for="lenScale">Length scale</label><input id="lenScaleValue" type="number" min="0.5" max="1.0" step="0.01" value="0.68"></div>
            <input id="lenScale" type="range" min="0.5" max="1.0" step="0.01" value="0.68" title="The ratio of a branch's length to its parent's length. Lower values create denser trees.">
            <div class="param-row"><label for="angle">Branch angle</label><input id="angleValue" type="number" min="0" max="90" value="25"></div>
            <input id="angle" type="range" min="0" max="90" value="25" title="The angle between the two main branches at each split.">
            <label style="display:block;margin-top:4px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="randomizeAnglePerTree" title="If checked, each new tree will start with a different, random base angle."> Randomize angle per tree
            </label>
            <div class="param-row"><label for="lenRand">Length Random</label><input id="lenRandValue" type="number" min="0" max="1" step="0.01" value="0.20"></div>
            <input id="lenRand" type="range" min="0" max="1" step="0.01" value="0.20" title="How much random variation to apply to branch lengths.">
            <label style="display:block;margin-top:4px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="unifyLenPerLevel" title="When checked, all branches on the same level will share the same random length modification."> Unify length per branch level
            </label>
            <div class="param-row"><label for="angleRand">Angle Random</label><input id="angleRandValue" type="number" min="0" max="1" step="0.01" value="0.20"></div>
            <input id="angleRand" type="range" min="0" max="1" step="0.01" value="0.20" title="How much random variation to apply to branch angles.">
            <label style="display:block;margin-top:4px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="unifyAnglePerLevel" title="When checked, all branch splits on the same level will share the same random angle modification."> Unify angle per branch level
            </label>
            <label style="display:block;margin-top:8px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="uniformAngleRand" title="If checked, the same angle randomness is applied to all branches on a single tree, creating a 'windswept' look.">
                Apply uniformly to all branches
            </label>
            <div class="param-row"><label for="baseWidth">Base width</label><input id="baseWidthValue" type="number" min="1" max="50" value="12"></div>
            <input id="baseWidth" type="range" min="1" max="50" value="12" title="The width of the first trunk segment in pixels.">
            <div class="param-row"><label for="widthScale">Width scale</label><input id="widthScaleValue" type="number" min="0.5" max="1.5" step="0.01" value="0.68"></div>
            <input id="widthScale" type="range" min="0.5" max="1.5" step="0.01" value="0.68" title="The ratio of a branch's width to its parent's width.">
            
            <button id="randomizeTreeBtn" class="action" style="width:100%; margin-top: 10px;">üé≤ Randomize Tree Shape</button>
    
            <hr style="opacity:.1; margin: 10px 0;">
            <label style="display: block;">
                <input type="checkbox" id="addTreeBlossoms"> Add Blossoms/Leaves
            </label>
            <div id="treeBlossomControls" style="display:none;">
                <div class="param-row"><label for="treeBlossomSize">Blossom Size</label><input id="treeBlossomSizeValue" type="number" min="1" max="15" value="3"></div>
                <input id="treeBlossomSize" type="range" min="1" max="15" value="3" title="The radius of the blossom circle in pixels.">
                <label class="row" for="treeBlossomColor">Blossom Color</label>
                <input id="treeBlossomColor" type="color" value="#ffc0cb">
            </div>
            <hr style="opacity:.1; margin: 10px 0;">
            <label style="display: block;">
                <input type="checkbox" id="addTreeShadow"> Add Shadow / Highlight
            </label>
            <div id="treeShadowControls" style="display:none;">
                <label class="row" for="treeShadowColor">Shadow Color</label>
                <input id="treeShadowColor" type="color" value="#FFFFFF">
                <div class="param-row"><label for="treeShadowBlur">Shadow Blur</label><input id="treeShadowBlurValue" type="number" min="0" max="50" value="5"></div>
                <input id="treeShadowBlur" type="range" min="0" max="50" value="5">
                <div class="param-row"><label for="treeShadowX">Shadow X Offset</label><input id="treeShadowXValue" type="number" min="-50" max="50" value="5"></div>
                <input id="treeShadowX" type="range" min="-50" max="50" value="5">
                <div class="param-row"><label for="treeShadowY">Shadow Y Offset</label><input id="treeShadowYValue" type="number" min="-50" max="50" value="5"></div>
                <input id="treeShadowY" type="range" min="-50" max="50" value="5">
            </div>
          </div>
    
          <div id="fernParams" style="margin-top:10px">
            <div class="param-row"><label for="fernPoints">Fern points</label><input id="fernPointsValue" type="number" min="100" max="20000" value="1000"></div>
            <input id="fernPoints" type="range" min="100" max="20000" step="100" value="1000" title="The number of points used to draw each fern. Higher values are denser.">
            <div class="param-row"><label for="fernSize">Fern size</label><input id="fernSizeValue" type="number" min="0.0005" max="0.2" step="0.0001" value="0.01"></div>
            <input id="fernSize" type="range" min="0.0005" max="0.2" step="0.0001" value="0.01" title="The overall size of the fern relative to the canvas height.">
            <label style="display:block;margin-top:8px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="spaceFerns" title="Introduces slight random variations to each fern's shape.">
                Enable "Space Ferns"
            </label>
          </div>
    
          <div id="pathParams" style="margin-top:10px; display:none;">
            <div class="param-row"><label for="pathWidth">Path Width</label><input id="pathWidthValue" type="number" min="1" max="100" value="5"></div>
            <input id="pathWidth" type="range" min="1" max="100" value="5" title="The width of the drawn path in pixels.">
            <div id="pathSegmentCycleContainer" style="display:none;">
                <label style="display:block;margin-top:8px;font-size:12px;color:var(--muted);">
                    <input type="checkbox" id="pathSegmentCycle" title="When 'Cycle Global Palette' is enabled, checking this will cycle the color for each segment of the path.">
                    Cycle Color per Segment
                </label>
            </div>
            <hr style="opacity:.1; margin: 10px 0;">
            <label style="display: block;">
                <input type="checkbox" id="pathAirbrush" title="Enable a soft, airbrush effect for the path tool."> Enable Airbrush Effect
            </label>
            <div id="airbrushControls" style="display:none;">
                <div class="param-row"><label for="airbrushSize">Airbrush Size</label><input id="airbrushSizeValue" type="number" min="1" max="50" value="15"></div>
                <input id="airbrushSize" type="range" min="1" max="50" value="15" title="The size and softness of the airbrush effect.">
            </div>
          </div>

          <div id="mountainParams" style="margin-top:10px; display:none;">
            <div class="param-row"><label for="mountainDetail">Detail Level</label><input id="mountainDetailValue" type="number" min="1" max="10" value="6"></div>
            <input id="mountainDetail" type="range" min="1" max="10" value="6" title="The number of recursive subdivisions. Higher values create more detailed mountains.">
            <div class="param-row"><label for="mountainHeight">Peak Height</label><input id="mountainHeightValue" type="number" min="10" max="300" value="100"></div>
            <input id="mountainHeight" type="range" min="10" max="300" value="100" title="The maximum initial height of the mountain peaks.">
            <div class="param-row"><label for="mountainJaggedness">Jaggedness</label><input id="mountainJaggednessValue" type="number" min="0.2" max="0.9" step="0.01" value="0.6"></div>
            <input id="mountainJaggedness" type="range" min="0.2" max="0.9" step="0.01" value="0.6" title="How rough the terrain is. Higher values are more jagged.">
            <label style="display:block;margin-top:8px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="mountainSmooth" title="Smooth the mountain ridgeline using a spline curve.">
                Smooth Ridgeline (Spline)
            </label>
            <hr style="opacity:.1; margin: 10px 0;">
            <label style="display: block;">
                <input type="checkbox" id="mountainGradient" title="Enable a two-color vertical gradient for the mountain fill. The top color is the 'Object Color' from the Color tab."> Enable Gradient Fill
            </label>
            <div id="mountainGradientControls" style="display:none;">
                <label class="row" for="mountainColor2">Bottom Color</label>
                <input type="color" id="mountainColor2" value="#4a4a4a">
            </div>
          </div>

          <div id="celestialParams" style="margin-top:10px; display:none;">
            <div class="param-row"><label for="celestialSize">Size</label><input id="celestialSizeValue" type="number" min="10" max="400" value="50"></div>
            <input id="celestialSize" type="range" min="10" max="400" value="50" title="The radius of the sun or moon in pixels.">
            <div class="param-row"><label for="celestialGlow">Glow Amount</label><input id="celestialGlowValue" type="number" min="0" max="100" value="30"></div>
            <input id="celestialGlow" type="range" min="0" max="100" value="30" title="The size and intensity of the object's glow.">
          </div>
    
          <div id="snowParams" style="margin-top: 10px">
            <div class="param-row"><label for="snowIter">Snowflake Iteration</label><input id="snowIterValue" type="number" min="1" max="6" value="4"></div>
            <input id="snowIter" type="range" min="1" max="6" step="1" value="4" title="The number of recursive iterations for the snowflake fractal. Higher is more detailed. (Max 6 for performance)">
            <div class="param-row"><label for="snowSize">Snowflake Size</label><input id="snowSizeValue" type="number" min="0.01" max="1" step="0.01" value="0.2"></div>
            <input id="snowSize" type="range" min="0.01" max="1" step="0.01" value="0.2" title="The overall size of the snowflake relative to the canvas size.">
            <div class="param-row"><label for="snowStroke">Line Width</label><input id="snowStrokeValue" type="number" min="1" max="50" value="2"></div>
            <input id="snowStroke" type="range" min="1" max="50" step="1" value="2" title="The width of the snowflake lines in pixels.">
          </div>
            
          <div id="flowerParams" style="margin-top: 10px">
            <div class="param-row"><label for="flowerIter">Flower Iteration</label><input id="flowerIterValue" type="number" min="1" max="6" value="3"></div>
            <input id="flowerIter" type="range" min="1" max="6" step="1" value="3" title="The number of L-System iterations. Higher values create a more complex flower. (Max 6 for performance)">
            <div class="param-row"><label for="flowerAngle">Flower Angle</label><input id="flowerAngleValue" type="number" min="1" max="90" value="60"></div>
            <input id="flowerAngle" type="range" min="1" max="90" step="1" value="60" title="The angle used for turning in the L-System rules.">
            <div class="param-row"><label for="flowerStep">Flower Step</label><input id="flowerStepValue" type="number" min="0.01" max="1" step="0.01" value="0.01"></div>
            <input id="flowerStep" type="range" min="0.01" max="1" step="0.01" value="0.01" title="The length of each forward step, relative to canvas size.">
            <div class="param-row"><label for="flowerStroke">Flower Stroke</label><input id="flowerStrokeValue" type="number" min="1" max="10" value="2"></div>
            <input id="flowerStroke" type="range" min="1" max="10" step="1" value="2" title="The width of the flower lines in pixels.">
    
            <hr style="opacity:.1; margin: 10px 0;">
            <label style="display: block;">
                <input type="checkbox" id="addFlowerBlossoms" title="Enable or disable blossoms at the tip of each stem."> Add Blossoms
            </label>
            <div id="flowerBlossomControls" style="display:none;">
                <div class="param-row"><label for="flowerBlossomSize">Blossom Size</label><input id="flowerBlossomSizeValue" type="number" min="1" max="15" value="2"></div>
                <input id="flowerBlossomSize" type="range" min="1" max="15" value="2" title="The radius of the blossom circle in pixels.">
                <label class="row" for="flowerBlossomColor">Blossom Color</label>
                <input id="flowerBlossomColor" type="color" value="#FFFFFF">
            </div>
          </div>
        
          <div id="vineParams" style="margin-top: 10px">
            <div class="param-row"><label for="vineLength">Vine Length</label><input id="vineLengthValue" type="number" min="1" max="200" value="100"></div>
            <input id="vineLength" type="range" min="1" max="200" step="1" value="100" title="The number of segments in the vine.">
            <div class="param-row"><label for="vineNoise">Vine Noise</label><input id="vineNoiseValue" type="number" min="0.001" max="1" step="0.001" value="0.01"></div>
            <input id="vineNoise" type="range" min="0.001" max="1" step="0.001" value="0.01" title="The scale of the Perlin noise, affecting how 'wavy' the vine is.">
            <div class="param-row"><label for="vineStroke">Vine Stroke</label><input id="vineStrokeValue" type="number" min="0.1" max="10" step="0.1" value="0.1"></div>
            <input id="vineStroke" type="range" min="0.1" max="10" step="0.1" value="0.1" title="The width of the vine in pixels.">
          </div>
        
            <div id="cloudParams" style="display:none">
              <div class="param-row"><label for="cloudCount">Puffs per cloud</label><input id="cloudCountValue" type="number" min="1" max="50" value="15"></div>
              <input id="cloudCount" type="range" min="1" max="50" value="15" title="The number of circular puffs drawn for each cloud stamp.">
              <div class="param-row"><label for="cloudMinD">Min puff diameter</label><input id="cloudMinDValue" type="number" min="1" max="400" value="10"></div>
              <input id="cloudMinD" type="range" min="1" max="400" value="10" title="The minimum possible diameter for a cloud puff.">
              <div class="param-row"><label for="cloudMaxD">Max puff diameter</label><input id="cloudMaxDValue" type="number" min="1" max="400" value="50"></div>
              <input id="cloudMaxD" type="range" min="1" max="400" value="50" title="The maximum possible diameter for a cloud puff.">
              
              <hr style="opacity:.1; margin: 10px 0;">
              <label class="row" for="cloudShadowColor">Highlight color</label>
              <input id="cloudShadowColor" type="color" value="#BEBEBE">
              <div class="param-row"><label for="cloudBlur">Highlight Blur</label><input id="cloudBlurValue" type="number" min="0" max="40" value="8"></div>
              <input id="cloudBlur" type="range" min="0" max="40" step="1" value="8" title="The blur radius for the cloud's highlight effect.">
              <div class="param-row"><label for="cloudShadowX">Highlight X Offset</label><input id="cloudShadowXValue" type="number" min="-50" max="50" value="8"></div>
              <input id="cloudShadowX" type="range" min="-50" max="50" value="8" title="The horizontal offset of the highlight.">
              <div class="param-row"><label for="cloudShadowY">Highlight Y Offset</label><input id="cloudShadowYValue" type="number" min="-50" max="50" value="8"></div>
              <input id="cloudShadowY" type="range" min="-50" max="50" value="8" title="The vertical offset of the highlight.">

              <hr style="opacity:.1; margin: 10px 0;">
              <label style="display: block;">
                  <input type="checkbox" id="animateClouds" title="Enable or disable a gentle drifting animation for all clouds."> Animate Cloud Drift
              </label>
              <div id="cloudAnimControls" style="display:none;">
                  <div class="param-row"><label for="cloudSpeed">Cloud Speed</label><input id="cloudSpeedValue" type="number" min="0" max="0.5" step="0.01" value="0.1"></div>
                  <input id="cloudSpeed" type="range" min="0" max="0.5" step="0.01" value="0.1" title="How fast the clouds drift.">
                  <div class="param-row"><label for="cloudDrift">Drift Amount</label><input id="cloudDriftValue" type="number" min="0" max="100" value="20"></div>
                  <input id="cloudDrift" type="range" min="0" max="100" step="1" value="20" title="How far the clouds drift from their original position.">
              </div>
            </div>

            <div id="lightningParams" style="display:none">
              <div class="param-row"><label for="lightningDepth">Branch Depth</label><input id="lightningDepthValue" type="number" min="1" max="5" value="3"></div>
              <input id="lightningDepth" type="range" min="1" max="5" value="3" title="How many times the lightning branches. Higher values create more complex bolts.">
              <div class="param-row"><label for="lightningSegmentLength">Segment Length</label><input id="lightningSegmentLengthValue" type="number" min="5" max="50" value="15"></div>
              <input id="lightningSegmentLength" type="range" min="5" max="50" value="15" title="Length of each lightning segment in pixels.">
              <div class="param-row"><label for="lightningJaggedness">Jaggedness</label><input id="lightningJaggednessValue" type="number" min="5" max="100" value="30"></div>
              <input id="lightningJaggedness" type="range" min="5" max="100" value="30" title="How jagged and chaotic the lightning appears.">
              <div class="param-row"><label for="lightningBranchProb">Branch Probability</label><input id="lightningBranchProbValue" type="number" min="0" max="0.5" step="0.01" value="0.15"></div>
              <input id="lightningBranchProb" type="range" min="0" max="0.5" step="0.01" value="0.15" title="Probability of lightning branching at each segment.">
              <div class="param-row"><label for="lightningWidth">Bolt Width</label><input id="lightningWidthValue" type="number" min="1" max="10" value="3"></div>
              <input id="lightningWidth" type="range" min="1" max="10" value="3" title="The width of the lightning bolt in pixels.">
            </div>

            <div id="grassParams" style="display:none">
              <div class="param-row"><label for="grassDensity">Blade Density</label><input id="grassDensityValue" type="number" min="10" max="200" value="50"></div>
              <input id="grassDensity" type="range" min="10" max="200" value="50" title="Number of grass blades per patch.">
              <div class="param-row"><label for="grassWidth">Patch Width</label><input id="grassWidthValue" type="number" min="20" max="400" value="100"></div>
              <input id="grassWidth" type="range" min="20" max="400" value="100" title="The width of the grass patch in pixels.">
              <div class="param-row"><label for="grassMinHeight">Min Height</label><input id="grassMinHeightValue" type="number" min="5" max="100" value="15"></div>
              <input id="grassMinHeight" type="range" min="5" max="100" value="15" title="Minimum height of grass blades.">
              <div class="param-row"><label for="grassMaxHeight">Max Height</label><input id="grassMaxHeightValue" type="number" min="10" max="200" value="40"></div>
              <input id="grassMaxHeight" type="range" min="10" max="200" value="40" title="Maximum height of grass blades.">
              <div class="param-row"><label for="grassBend">Bend Amount</label><input id="grassBendValue" type="number" min="0" max="1" step="0.01" value="0.3"></div>
              <input id="grassBend" type="range" min="0" max="1" step="0.01" value="0.3" title="How much the grass blades bend and curve.">
              <div class="param-row"><label for="grassMinThickness">Min Thickness</label><input id="grassMinThicknessValue" type="number" min="0.5" max="5" step="0.1" value="1"></div>
              <input id="grassMinThickness" type="range" min="0.5" max="5" step="0.1" value="1" title="Minimum thickness of grass blades.">
              <div class="param-row"><label for="grassMaxThickness">Max Thickness</label><input id="grassMaxThicknessValue" type="number" min="0.5" max="5" step="0.1" value="2"></div>
              <input id="grassMaxThickness" type="range" min="0.5" max="5" step="0.1" value="2" title="Maximum thickness of grass blades.">
            </div>

            <div id="sierpinskiParams" style="display:none">
              <div class="param-row"><label for="sierpinskiIterations">Iterations</label><input id="sierpinskiIterationsValue" type="number" min="1" max="8" value="5"></div>
              <input id="sierpinskiIterations" type="range" min="1" max="8" value="5" title="Number of recursive subdivisions. Higher values create more detailed gaskets.">
              <div class="param-row"><label for="sierpinskiSize">Size</label><input id="sierpinskiSizeValue" type="number" min="50" max="500" value="200"></div>
              <input id="sierpinskiSize" type="range" min="50" max="500" value="200" title="The size of the Sierpinski gasket.">
              <div class="param-row"><label for="sierpinskiStroke">Line Width</label><input id="sierpinskiStrokeValue" type="number" min="0.5" max="5" step="0.1" value="1"></div>
              <input id="sierpinskiStroke" type="range" min="0.5" max="5" step="0.1" value="1" title="The width of the triangle outlines.">
              <label style="display:block;margin-top:8px;">
                <input type="checkbox" id="sierpinskiFilled" title="Fill the triangles instead of just outlining them."> Fill Triangles
              </label>
            </div>

            <div id="dragonParams" style="display:none">
              <div class="param-row"><label for="dragonIterations">Iterations</label><input id="dragonIterationsValue" type="number" min="1" max="15" value="10"></div>
              <input id="dragonIterations" type="range" min="1" max="15" value="10" title="Number of L-system iterations. Higher values create more complex curves. (Max 15 for performance)">
              <div class="param-row"><label for="dragonStep">Step Size</label><input id="dragonStepValue" type="number" min="1" max="20" value="5"></div>
              <input id="dragonStep" type="range" min="1" max="20" value="5" title="Length of each step in pixels.">
              <div class="param-row"><label for="dragonStroke">Line Width</label><input id="dragonStrokeValue" type="number" min="0.5" max="10" step="0.1" value="2"></div>
              <input id="dragonStroke" type="range" min="0.5" max="10" step="0.1" value="2" title="The width of the dragon curve line.">
            </div>

            <div id="textureParams" style="display:none">
              <label class="row" for="textureType">Texture Type</label>
              <select id="textureType">
                <option value="stipple">Stipple/Dots</option>
                <option value="hatch">Hatching</option>
                <option value="crosshatch">Cross-Hatch</option>
                <option value="bark">Bark</option>
                <option value="scales">Scales</option>
                <option value="fur">Fur/Hair</option>
                <option value="ripples">Water Ripples</option>
                <option value="stone">Stone</option>
              </select>
              <div class="param-row"><label for="textureBrushSize">Brush Size</label><input id="textureBrushSizeValue" type="number" min="20" max="300" value="100"></div>
              <input id="textureBrushSize" type="range" min="20" max="300" value="100" title="The size of each texture stamp.">
              <div class="param-row"><label for="textureDensity">Density</label><input id="textureDensityValue" type="number" min="0.1" max="2" step="0.1" value="1"></div>
              <input id="textureDensity" type="range" min="0.1" max="2" step="0.1" value="1" title="How tightly packed the texture elements are.">
              <div class="param-row"><label for="textureScale">Pattern Scale</label><input id="textureScaleValue" type="number" min="0.5" max="3" step="0.1" value="1"></div>
              <input id="textureScale" type="range" min="0.5" max="3" step="0.1" value="1" title="Size of individual texture elements.">
              <div class="param-row"><label for="textureRotation">Rotation</label><input id="textureRotationValue" type="number" min="0" max="180" value="0"></div>
              <input id="textureRotation" type="range" min="0" max="180" value="0" title="Pattern orientation in degrees.">
              <div class="param-row"><label for="textureRandomness">Randomness</label><input id="textureRandomnessValue" type="number" min="0" max="1" step="0.1" value="0.3"></div>
              <input id="textureRandomness" type="range" min="0" max="1" step="0.1" value="0.3" title="Amount of variation in the pattern.">
              <div class="param-row"><label for="textureStroke">Line Width</label><input id="textureStrokeValue" type="number" min="0.5" max="5" step="0.1" value="1"></div>
              <input id="textureStroke" type="range" min="0.5" max="5" step="0.1" value="1" title="Width of lines in the texture pattern.">
            </div>

            <div id="otherScaleControls" style="margin-top:10px">
              <div class="param-row"><label for="otherScaleMin">Non-tree scale MIN</label><input id="otherScaleMinValue" type="number" min="0.2" max="3" step="0.01" value="0.8"></div>
              <input id="otherScaleMin" type="range" min="0.2" max="3" step="0.01" value="0.8" title="The minimum random size multiplier for non-tree objects.">
              <div class="param-row"><label for="otherScaleMax">Non-tree scale MAX</label><input id="otherScaleMaxValue" type="number" min="0.2" max="3" step="0.01" value="1.2"></div>
              <input id="otherScaleMax" type="range" min="0.2" max="3" step="0.01" value="1.2" title="The maximum random size multiplier for non-tree objects.">
            </div>
    
          <div id="eraserParams" style="margin-top:10px; display:none">
            <div class="param-row"><label for="eraserSize">Eraser size</label><input id="eraserSizeValue" type="number" min="6" max="80" value="24"></div>
            <input id="eraserSize" type="range" min="6" max="80" value="24" title="The width of the eraser stroke in pixels.">
          </div>
    
            <div id="svgExportOptions" style="margin-top:10px">
              <div class="param-row"><label for="svgFernThin">SVG fern thinning</label><input id="svgFernThinValue" type="number" min="1" max="8" value="1"></div>
              <input id="svgFernThin" type="range" min="1" max="8" step="1" value="1" title="Reduces the number of points in exported SVG ferns to keep file sizes small. 1x is full detail.">
              <label style="display:block;margin-top:8px;">
                <input type="checkbox" id="svgGroupByLevel" title="In the exported SVG, group all branches of the same level into a <g> tag.">
                Group tree segments by level
              </label>
            </div>
            <div class="hint small">Tip: In Tree mode, click a branch segment to select its <em>level</em>. Edit its color/alpha in the Color tab.</div>
    
            <div id="animParams" style="margin-top:10px">
              <label style="display: block;">
                  <input type="checkbox" id="animateWind" title="Enable or disable a gentle swaying animation for all trees."> Animate Tree Wind (Sway)
              </label>
              <div class="param-row"><label for="windAmp">Wind amplitude</label><input id="windAmpValue" type="number" min="0" max="15" step="0.1" value="3"></div>
              <input id="windAmp" type="range" min="0" max="15" step="0.1" value="3" title="How far the branches sway in the wind.">
              <div class="param-row"><label for="windSpeed">Wind speed</label><input id="windSpeedValue" type="number" min="0" max="1" step="0.01" value="0.2"></div>
              <input id="windSpeed" type="range" min="0" max="1" step="0.01" value="0.20" title="How fast the branches sway in the wind.">
            </div>
        </div>
    
        <div id="colorTab" class="tab">
            <div id="nonTreeColorSection">
                <label for="nonTreeColorMode">Coloring for Non-Tree Objects</label>
                <select id="nonTreeColorMode">
                    <option value="single">Single Color</option>
                    <option value="cycle">Cycle Global Palette</option>
                </select>
                <div id="singleColorBox" style="margin-top: 6px;">
                    <label class="row" for="singleColor">Object Color</label>
                    <input id="singleColor" type="color" value="#FFFFFF">
                </div>
            </div>
            
            <hr style="opacity:.2;margin:10px 0;">
            <div id="newObjectAlphaSection" style="margin-top:8px;">
                <label>
                    <input type="checkbox" id="applyNewObjectAlpha" title="Enable to set a custom transparency for all new objects being drawn.">
                    Set transparency for new objects
                </label>
                <div id="newObjectAlphaControls" style="display:none; margin-top: 6px;">
                    <div class="param-row"><label for="newObjectAlphaSlider">Object Alpha</label><input id="newObjectAlphaValue" type="number" min="0" max="1" step="0.01" value="1"></div>
                    <input id="newObjectAlphaSlider" type="range" min="0" max="1" step="0.01" value="1" title="The alpha (transparency) value for new objects. 0 is fully transparent, 1 is fully opaque.">
                </div>
            </div>
    
            <div class="small">This palette is used for tree branch colors and as a source for other objects when "Cycle Palette" is selected below.</div>
            <hr style="opacity:.2;margin:10px 0;">
            <div id="branchColorPanel" class="visible" aria-hidden="false"></div>
            <label style="margin-top: 8px; display: block;">
                <input type="checkbox" id="randomBranchColor" title="When checked, each new branch on a tree will be a random color from the palette, instead of based on its level."> Random Branch Color (Trees Only)
            </label>
            <div id="randomColorModeContainer" style="display:none; padding-left: 20px;">
                <label style="display:block; font-size:12px; color:var(--muted);">
                    <input type="checkbox" id="randomColorPerLevel" title="When checked, all branches on the same level will share one random color. When unchecked, every single branch will get a different random color.">
                    Unify color per branch level
                </label>
            </div>
            <hr style="opacity:.2;margin:10px 0;">
    
          <div id="levelEditBox" style="display:none; margin-top:10px">
            <div class="small">Editing level: <strong id="editingLevelText"></strong></div>
            <div class="param-row"><label for="levelAlpha">Level alpha</label><input id="levelAlphaValue" type="number" min="0" max="1" step="0.01" value="1"></div>
            <input id="levelAlpha" type="range" min="0" max="1" step="0.01" value="1" title="The alpha (transparency) of the selected branch level.">
            <label>
                <input type="checkbox" id="applyAllTrees" title="When checked, changes to this level's alpha or color will apply to ALL trees on the canvas, not just the selected one.">
                Apply to all trees at this level
            </label>
          </div>
    
        <div id="backgroundColorPanel" style="margin-top:1em;">
          <label for="backgroundColor">Background Color 1:</label>
          <input type="color" id="backgroundColor" value="#000000">
          <label style="display: block; margin-top: 8px;">
            <input type="checkbox" id="enableGradient" title="Enable a two-color gradient for the background."> Enable Background Gradient
          </label>
          <div id="gradientControls" style="display:none;">
            <label for="backgroundColor2">Background Color 2:</label>
            <input type="color" id="backgroundColor2" value="#071022">
          </div>
        </div>
        </div>
    
        <div id="presetsTab" class="tab">
            <div class="small">Select a predefined color palette. This will update the Global Color Palette in the "Color" tab.</div>
            <hr style="opacity:.2;margin:10px 0;">
            <div id="palettePresetsContainer"></div>
        </div>
    
        <div id="historyTab" class="tab">
          <div class="small">Undo/Redo captures: object additions, color/alpha edits, and eraser strokes.</div>
          <hr style="opacity:.2;margin:10px 0;">
          <div id="playbackControls">
              <button id="playbackBtn" class="action">Playback</button>
              <div style="margin-top: 6px;">
                  <div class="param-row"><label for="playbackSpeed">Playback Speed</label><input id="playbackSpeedValue" type="number" min="1" max="1000" value="500"></div>
                  <input id="playbackSpeed" type="range" min="1" max="1000" value="500" title="The speed of the history playback.">
              </div>
          </div>
          <hr style="opacity:.2;margin:10px 0;">
          <div id="sessionControls" class="btnrow">
              <button id="exportSessionBtn" class="action">Export Session</button>
              <button id="loadSessionBtn" class="action">Load Session</button>
              <input type="file" id="sessionFileInput" accept=".json,.gz" style="display: none;">
          </div>
          <div style="margin-top: 8px;">
            <label>
                <input type="checkbox" id="saveSceneOnly"> Save current scene only (smaller file)
            </label>
          </div>
          <div id="sessionInfoDisplay" class="small hint" style="margin-top: 10px;"></div>
        </div>
    </div>
  </div>

  <div id="canvasWrap">
    <canvas id="treeCanvas"></canvas>
    <canvas id="eraserCanvas"></canvas>
  </div>
</main>
<script src="fractals.js" type="text/javascript"></script>
<script src="ui.js" type="text/javascript"></script>
<script src="main.js" type="text/javascript"></script>
</body>
</html>